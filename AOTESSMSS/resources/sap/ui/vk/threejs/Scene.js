/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","../Scene","./NodeHierarchy","sap/ui/vk/threejs/thirdparty/totara"],function(q,S,N,t){"use strict";var a=S.extend("sap.ui.vk.threejs.Scene",{metadata:{publicMethods:["getDefaultNodeHierarchy","getId","getSceneRef"]},constructor:function(s){S.call(this);this._id=q.sap.uid();this._scene=s;this._state=null;this._defaultNodeHierarchy=null;}});a.prototype.destroy=function(){if(this._defaultNodeHierarchy){this._defaultNodeHierarchy.destroy();this._defaultNodeHierarchy=null;}this._state=null;this._scene=null;S.prototype.destroy.call(this);};a.prototype.getId=function(){return this._id;};a.prototype.getDefaultNodeHierarchy=function(){if(!this._defaultNodeHierarchy){this._defaultNodeHierarchy=new N(this);}return this._defaultNodeHierarchy;};function b(c,d){var e=c.min,f=c.max,m=d.elements,g=(e.x+f.x)*0.5,h=(e.y+f.y)*0.5,i=(e.z+f.z)*0.5,j=f.x-g,k=f.y-h,l=f.z-i;var n=m[0]*g+m[4]*h+m[8]*i+m[12];var o=m[1]*g+m[5]*h+m[9]*i+m[13];var p=m[2]*g+m[6]*h+m[10]*i+m[14];var r=Math.abs(m[0]*j)+Math.abs(m[4]*k)+Math.abs(m[8]*l);var s=Math.abs(m[1]*j)+Math.abs(m[5]*k)+Math.abs(m[9]*l);var u=Math.abs(m[2]*j)+Math.abs(m[6]*k)+Math.abs(m[10]*l);e.set(n-r,o-s,p-u);f.set(n+r,o+s,p+u);}a.prototype._computeBoundingBox=function(){var c=new THREE.Box3();if(this._scene){var n=new THREE.Box3();this._scene.traverse(function(d){var g=d.geometry;if(g!==undefined){if(!g.boundingBox){g.computeBoundingBox();}if(!g.boundingBox.isEmpty()){n.copy(g.boundingBox);b(n,d.matrixWorld);c.min.min(n.min);c.max.max(n.max);}}});}return c;};a.prototype.getSceneRef=function(){return this._scene;};a.prototype._setState=function(s){this._state=s;};a.prototype.nodeRefToPersistentId=function(n){if(Array.isArray(n)){var i=[];n.forEach(function(c){i.push(Totara.object3DToSid(c));});return i;}else{return Totara.object3DToSid(n);}};a.prototype.persistentIdToNodeRef=function(p){if(Array.isArray(p)){var s=this._state;var n=[];p.forEach(function(c){n.push(Totara.sidToObject3D(s,c));});return n;}else{return Totara.sidToObject3D(this._state,p);}};return a;});
