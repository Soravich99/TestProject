sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/suite/ui/generic/template/ListReport/controller/MultipleViewsSingleTableModeHelper","sap/suite/ui/generic/template/ListReport/controller/MultipleViewsMultipleTablesModeHelper","sap/suite/ui/generic/template/lib/BusyHelper"],function(q,B,M,a,b){"use strict";var P="/listReport/multipleViews";var c=P+"/selectedKey";var d=P+"/mode";var e=P+"/items";function g(s,C,t){var I;var Q;var m;var S;var T=t.oComponentUtils.getTemplatePrivateModel();var o={};var f;var D=t.oServices.oApplication.getBusyHelper().getBusyDelay();function h(){return Q&&Q.enableAutoBinding;}function r(){if(I&&I.fnRegisterToChartEvents){return I.fnRegisterToChartEvents.apply(null,arguments);}}function j(){if(I&&I.onDetailsActionPress){return I.onDetailsActionPress.apply(null,arguments);}}function k(){if(!I){return;}var i=w();if(i){return i.templateSortOrder;}}function l(i){var F;if(!i){return"";}if(i.state==="error"){return t.oCommonUtils.getText("SEG_BUTTON_ERROR",i.text);}if(i.state===""||i.state==="busy"){var A=sap.ui.core.format.NumberFormat.getIntegerInstance({style:"short"});F=A.format(i.count);}return t.oCommonUtils.getText("SEG_BUTTON_TEXT",[i.text,i.state==="busyLong"?"...":F]);}function n(){if(I){var i=T.getProperty(c);var A=I.getContentForIappState(i);return{mode:m,state:A};}}function R(G){if(I){var i=I.getSelectedKeyAndRestoreFromIappState(G);T.setProperty(c,i);}}function p(){return T.getProperty(c);}function u(E){if(!I){return;}var i=function(K,A,F){var G=t.oCommonUtils.getElementCustomData(A);var H=f[K]||Object.create(null);H.selectionVariantFilters=F;H.templateSortOrder=G.TemplateSortOrder;H.implementingControl=A;f[K]=H;if(S){var J=e+"/"+K;var L=function(O,V,W){if(H.numberOfUpdates!==V){return;}var N=q.extend({},T.getProperty(J));if(!N.state&&O=="busy"){setTimeout(function(){if(T.getProperty(J).state==="busy"){N=q.extend({},T.getProperty(J));N.state="busyLong";T.setProperty(J,N);}},D);}N.state=O;if(!O){N.count=W;}T.setProperty(J,N);};H.numberOfUpdates=0;H.updateStartFunction=L.bind(null,"busy");H.updateSuccessFunction=L.bind(null,"");H.errorFunction=L.bind(null,"error");var N={text:G.text,count:0,state:""};T.setProperty(J,N);}};I.init(E,i);}function v(){return m;}function w(){return f[T.getProperty(c)];}function x(E){if(!I){return;}var A=E.getParameter("bindingParams");o.filters=A.filters.slice(0);o.parameters=A.parameters;var F=w();var G=F.selectionVariantFilters;for(var i in G){A.filters.push(G[i]);}}function U(){var i=s.oSmartTable.getModel();var A=s.oSmartTable.getEntitySet();var E=s.oSmartFilterbar.getBasicSearchValue();var F={};if(E){F={search:E};}for(var K in f){var G=f[K];G.numberOfUpdates++;G.updateStartFunction(G.numberOfUpdates);var H=o.filters.concat(G.selectionVariantFilters);i.read("/"+A+"/$count",{urlParameters:F,filters:H,groupId:"updateMultipleViewsItemsCounts",success:G.updateSuccessFunction.bind(null,G.numberOfUpdates),error:G.errorFunction.bind(null,G.numberOfUpdates)});}}function y(){if(S){U();}}function z(){return I;}(function(){var i,A,E,F;i=C.getOwnerComponent().getAppComponent().getConfig();A=i&&i.pages[0]&&i.pages[0].component&&i.pages[0].component.settings;if(!A){return;}E=A.quickVariantSelectionX;F=A.quickVariantSelection;if(E&&F){throw new Error("Defining both QuickVariantSelection and QuickVariantSelectionX in the manifest is not allowed.");}Q=E||F;if(!Q){return;}S=Q.showCounts;f=Object.create(null);T.setProperty(P,Object.create(null));T.setProperty(e,Object.create(null));var G=function(H){T.setProperty(c,H);var J=T.bindProperty(c);J.attachChange(function(K){if(I.onSelectedKeyChanged){var N=K.getSource().getValue();I.onSelectedKeyChanged(N);}var L=s.oIappStateHandler.areDataShownInTable();var O=true;if(typeof I.isTableDirty==='function'){O=I.isTableDirty(s.oSmartTable);}if(L&&O){if(t.oCommonUtils.isSmartChart(s.oSmartTable)){s.oSmartTable.rebindChart();if(typeof I.setTableDirty==='function'){I.setTableDirty(s.oSmartTable,false);}}else if(t.oCommonUtils.isSmartTable(s.oSmartTable)){s.oSmartTable.rebindTable();t.oCommonUtils.refreshSmartTable(s.oSmartTable);}}else{t.oCommonUtils.setEnabledToolbarButtons(s.oSmartTable);}s.oIappStateHandler.changeIappState(true,L);});};if(F){I=new M(F,s,C,t,G,f);m="single";q.sap.log.info("This list supports multiple views with single table");}else{I=new a(E,s,C,t,G,f);m="multi";q.sap.log.info("This list supports multiple views with multiple tables/charts");}T.setProperty(d,m);})();return{getEnableAutoBinding:h,fnRegisterToChartEvents:r,onDetailsActionPress:j,determineSortOrder:k,onDataRequested:y,formatItemTextForMultipleView:l,getContentForIappState:n,restoreFromIappState:R,getVariantSelectionKey:p,init:u,getMode:v,onRebindContentControl:x,getImplementingHelper:z};}return B.extend("sap.suite.ui.generic.template.ListReport.controller.MultipleViewsHandler",{constructor:function(s,C,t){q.extend(this,g(s,C,t));}});});
