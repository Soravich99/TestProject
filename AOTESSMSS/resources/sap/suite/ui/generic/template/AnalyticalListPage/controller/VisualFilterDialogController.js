sap.ui.define(["sap/m/Button","sap/m/ButtonType","sap/m/Label","sap/m/Dialog","sap/m/Bar","sap/m/SearchField","sap/m/Toolbar","sap/m/ToolbarSpacer","sap/m/Title","sap/m/VBox","sap/m/HBox","sap/m/CheckBox","sap/m/Link","sap/m/List","sap/m/TextArea","sap/m/Text","sap/m/StandardListItem","sap/m/ListSeparators","sap/m/Popover","sap/ui/layout/form/SimpleForm","sap/ui/layout/GridData","sap/ui/core/mvc/Controller","sap/suite/ui/generic/template/AnalyticalListPage/util/FilterUtil","sap/m/SegmentedButton","sap/m/SegmentedButtonItem","sap/suite/ui/generic/template/AnalyticalListPage/util/V4Terms",'sap/ui/model/Filter',"sap/suite/ui/generic/template/AnalyticalListPage/controller/DropDownController","sap/m/OverflowToolbarButton"],function(B,a,L,D,b,S,T,c,d,V,H,C,f,g,h,j,k,l,P,m,G,n,F,o,p,q,r,s,O){"use strict";var t="_BASIC";var u="100%";var v=0.33;var w=0.5;var x=n.extend("sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController",{init:function(e){this.oState=e;this.oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.comp");this.bIsTimeBasedLine;this.bSortOrder;},_createForm:function(){this.sJsonModel=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel').getJSON();this.oConfig=JSON.parse(this.sJsonModel);this._filterModified=false;this.filterCompList=[];this.filterChartList=[];this._buildFiltersFromConfig();this.oVerticalBox=new V();this.oVerticalBox.setModel(this.oState.oController.getView().getModel("_templPriv"),"_templPriv");this.oVerticalBox.setModel(this.oState.oController.getView().getModel());this.oVerticalBox.setModel(this.oState.oController.getView().getModel("i18n"),"i18n");this.oVerticalBox.setModel(this.oState.oController.getOwnerComponent().getModel("_filter"),"_filter");this.oVerticalBox.setModel(this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),"_visualFilterConfigModel");this._addFilterSwitch();this._addGroupsAndFilters();return this.oVerticalBox;},_toggle:function(){var e=this.oState.oSmartFilterbar.getFilterDialogContent();if(e&&(e.length===2)){if(e[0].getVisible()){e[0].setVisible(false);e[1].setVisible(true);e[1].getItems()[0].getContent()[1].addCustomData(new sap.ui.core.CustomData({key:'isToggle',value:true}));}else{e[0].setVisible(true);e[1].setVisible(false);e[0].getToolbar().getContent()[1].addCustomData(new sap.ui.core.CustomData({key:'isToggle',value:true}));}}},_addFilterSwitch:function(){var e=[new sap.m.SegmentedButtonItem({icon:"sap-icon://filter-fields",width:"inherit",key:"compact",tooltip:"{i18n>FILTER_COMPACT}"}),new sap.m.SegmentedButtonItem({icon:"sap-icon://filter-analytics",width:"inherit",key:"visual",tooltip:"{i18n>FILTER_VISUAL}"})];var i=new o({width:"inherit",selectedKey:"visual",items:e}).addEventDelegate({onAfterRendering:function(E){if(E.srcControl.getCustomData()[0]&&E.srcControl.getCustomData()[0].getValue()){E.srcControl.focus();E.srcControl.removeAllCustomData();}}});i.attachSelect(function(E){var z=E.getSource();z.setSelectedKey("visual");this._toggle();}.bind(this));var y=new sap.m.OverflowToolbar({design:sap.m.ToolbarDesign.Transparent,content:[new sap.m.ToolbarSpacer(),i]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogToolbar");this.oVerticalBox.addItem(y);},_searchDialog:function(){this.oState.alr_visualFilterBar._setVariantModified();},_restoreDialog:function(){this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel').setData(JSON.parse(this.sJsonModel));this.oConfig=JSON.parse(this.sJsonModel);this._reloadForm();this._filterModified=false;},_cancelDialog:function(){if(this._filterModified){var e=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel');e.setData(JSON.parse(this.sJsonModel));this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}},_buildFiltersFromConfig:function(){var i;this.filterCompList=[];this.filterChartList=[];for(i=0;i<this.oConfig.filterCompList.length;i++){var e=this.oConfig.filterCompList[i].component.properties.sortOrder;if(e.constructor===Object&&e.value){this.oConfig.filterCompList[i].component.properties.sortOrder=e.value;}this.filterCompList.push({obj:{shownInFilterBar:this.oConfig.filterCompList[i].shownInFilterBar,shownInFilterDialog:this.oConfig.filterCompList[i].shownInFilterDialog,cellHeight:this.oConfig.filterCompList[i].cellHeight,component:{type:this.oConfig.filterCompList[i].component.type,cellHeight:this.oConfig.filterCompList[i].component.cellHeight},group:{label:this.oConfig.filterCompList[i].group.label,name:this.oConfig.filterCompList[i].group.name}},searchVisible:this.oConfig.filterCompList[i].searchVisible===undefined||this.oConfig.filterCompList[i].searchVisible});}},_rebuildConfig:function(){var i;var e={filterCompList:[]};for(i=0;i<this.filterCompList.length;i++){e.filterCompList.push({shownInFilterBar:this.filterCompList[i].obj.shownInFilterBar&&this.filterCompList[i].obj.shownInFilterDialog,shownInFilterDialog:this.filterCompList[i].obj.shownInFilterDialog,cellHeight:this.filterCompList[i].obj.cellHeight,group:{label:this.filterCompList[i].obj.group.label,name:this.filterCompList[i].obj.group.name},component:{type:this.filterCompList[i].obj.component.type,cellHeight:this.filterCompList[i].obj.component.cellHeight,properties:{scaleFactor:this.filterChartList[i].getScaleFactor(),numberOfFractionalDigits:this.filterChartList[i].getNumberOfFractionalDigits(),sortOrder:this.filterChartList[i].getSortOrder(),filterRestriction:this.oConfig.filterCompList[i].component.properties.filterRestriction,entitySet:this.filterChartList[i].getEntitySet(),isDropDown:this.oConfig.filterCompList[i].component.properties.isDropDown,width:this.oConfig.filterCompList[i].component.properties.width,height:this.oConfig.filterCompList[i].component.properties.height,dimensionField:this.filterChartList[i].getDimensionField(),dimensionFieldDisplay:this.filterChartList[i].getDimensionFieldDisplay(),dimensionFieldIsDateTime:this.filterChartList[i].getDimensionFieldIsDateTime(),dimensionFilter:this.filterChartList[i].getDimensionFilter(),unitField:this.filterChartList[i].getUnitField(),isCurrency:this.filterChartList[i].getIsCurrency(),isMandatory:this.oConfig.filterCompList[i].component.properties.isMandatory,measureField:this.filterChartList[i].getMeasureField(),outParameter:this.oConfig.filterCompList[i].component.properties.outParameter,inParameters:this.oConfig.filterCompList[i].component.properties.inParameters,parentProperty:this.oConfig.filterCompList[i].component.properties.parentProperty,chartQualifier:this.oConfig.filterCompList[i].component.properties.chartQualifier}}});}return e;},_reloadForm:function(){this.oVerticalBox.destroyItems();this._buildFiltersFromConfig();this._addFilterSwitch();this._addGroupsAndFilters();},_addGroupsAndFilters:function(){var i;var e;var y;var z=[];var A=0;for(i=0;i<this.filterCompList.length;i++){if(!Array.isArray(this.filterCompList[i])){if(this.filterCompList[i].searchVisible===false){continue;}if(!(z.indexOf(this.filterCompList[i].obj.group.name)>-1)){if(y){this.oVerticalBox.addItem(y);}e=this.filterCompList[i].obj.group.name;z.push(e);y=new V();y.setWidth("100%");y.setLayoutData(new G({span:"L12 M12 S12"}));y.addStyleClass("sapUiSmallMarginTop");A++;this._addGroupToolbar(y,this.filterCompList[i].obj.group.label,this.filterCompList[i].obj.group.name);}if(this.filterCompList[i].obj.shownInFilterDialog){this.filterCompList[i].toolbar=this._addChartCustomToolbar(this.oConfig.filterCompList[i],i);this.filterCompList[i].overlay=this._addChartOverlay(this.oConfig.filterCompList[i],i);this.filterChartList[i]=this._addChart(this.oConfig.filterCompList[i].component.type,this.oConfig.filterCompList[i].component.properties,i);var E=this,I=this.filterChartList[i].getParentProperty().replace(/[^\w]/gi,'')+"checkBox";var J=[new V({items:[E.filterCompList[i].toolbar,E.filterCompList[i].overlay,E.filterChartList[i]]}).setWidth("100%").addStyleClass("sapUiSmallMarginEnd")];if(sap.ui.Device.system.desktop){J[0].setWidth("80%");J.splice(1,0,new V({items:[new L({text:"{i18n>SHOW_ON_FILTER_BAR}",labelFor:I}).addStyleClass("sapUiTinyMarginTop"),new C({id:I,text:"",selected:E.oConfig.filterCompList[i].shownInFilterBar}).data("idx",i).attachSelect(null,E._onCheckBoxSelect,E)]}).setAlignItems("Center"));J[1].setWidth("20%");}var K=new H({items:J}).addStyleClass("sapUiSmallMarginTop").setWidth("100%");y.addItem(K);}}if(y){this.oVerticalBox.addItem(y);}}if(A==1&&e===t){F.executeFunction(y,"mAggregations.items.0.setVisible",[false]);}},_onCheckBoxSelect:function(e){var i=e.getSource().data("idx");this.selectCheckBox(i,e.getSource().getSelected());},_addGroupToolbar:function(e,i,y){var z=new d({text:i});var A=new T({content:[z,new c()]});if(y!=t){A.addContent(this._createMoreFiltersLink(y,z));}e.addItem(A);},selectCheckBox:function(i,e){this._filterModified=true;var y=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),z=jQuery.extend(true,{},y);z.setProperty('/filterCompList/'+i+'/shownInFilterBar',e);y.setData(z.getData());this.oConfig=JSON.parse(y.getJSON());this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_addChartOverlay:function(e,i){var y=new V({width:"100%",height:e.component.properties.height,items:[new sap.m.Label({text:{path:'_visualFilterConfigModel>/filterCompList/'+i+'/overlayMessage',formatter:function(z){return this.getModel("i18n").getResourceBundle().getText(z);}}})],visible:{path:'_visualFilterConfigModel>/filterCompList/'+i+'/showChartOverlay',formatter:function(z){return z;}}});y.addStyleClass("sapUiOverlay");y.addStyleClass("sapSmartTemplatesAnalyticalListPageVFOverflow");return y;},_addChartCustomToolbar:function(e,i){var y=this;var z=e.component.properties.parentProperty,A=e.component.properties,E=F.getPropertyNameDisplay(this.oState.alr_visualFilterBar.getModel(),e.component.properties.entitySet,e.component.properties.dimensionField),M=z.replace(/[^\w]/gi,''),I=this.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(e.component.properties.entitySet),J=e.component.properties.sortOrder[0].Descending.Boolean,K=F.readProperty(e,"component.type")==="Line"&&F.readProperty(e,"component.properties.dimensionFieldIsDateTime"),N=this.oState.alr_visualFilterBar._resolveChartType(e.component.type),Q=this._getChartTypeIconLink(N),R=new L({text:y._getChartTitle(e,i),tooltip:y._getChartTitle(e,i)});if(this.oConfig.filterCompList[i].component.properties.isMandatory){R.addStyleClass("sapMLabelRequired");}var U=this.oState.oSmartFilterbar.getControlByKey(e.component.properties.parentProperty);this.oState.oSmartFilterbar.ensureLoadedValueHelp(e.component.properties.parentProperty);var W=U.getShowValueHelp&&U.getShowValueHelp(),X=(A.isDropDown)?"sap-icon://slim-arrow-down":"",Y=W?"sap-icon://value-help":X,Z,$=this.oVerticalBox.getModel("i18n").getResourceBundle(),_=[new B({type:"Transparent",icon:"sap-icon://line-chart-time-axis",visible:false,press:function(b1){y._showLineChartTimeAxisPopup(b1);}}).data("idx",i),new B({type:"Transparent",icon:(W||A.isDropDown)?Y:"",visible:{path:"_filter>/"+z,formatter:function(b1){if(W||A.isDropDown){return true;}else{if(!b1){return false;}if(typeof b1==="object"){return(b1.value||(b1.items&&b1.items.length)||(b1.ranges&&b1.ranges.length))?true:false;}return true;}}},text:{path:"_filter>/"+z,formatter:function(b1){Z=0;if(b1){if(typeof b1==="object"){if(b1.value){Z++;}if(b1.items){Z+=b1.items.length;}if(b1.ranges){Z+=b1.ranges.length;}}else{Z++;}}return Z?"("+Z+")":"";}},press:function(b1){if(W){U.fireValueHelpRequest.call(U);}else if(A.isDropDown){s.createDropdown(b1.getSource(),y.filterChartList[b1.getSource().data("idx")],this.getModel(),E,A);}else{sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup(b1.getSource(),y.filterChartList[b1.getSource().data("idx")],b1.getSource().getModel('i18n'));}},tooltip:{path:"_filter>/"+z,formatter:function(){return F.getTooltipForValueHelp(W,E,$,Z);}},layoutData:new sap.m.OverflowToolbarLayoutData({priority:sap.m.OverflowToolbarPriority.NeverOverflow})}).data("idx",i),new O({type:"Transparent",icon:(J?"sap-icon://sort-descending":"sap-icon://sort-ascending"),visible:!K,tooltip:"{i18n>VISUAL_FILTER_SORT_ORDER}",text:"{i18n>VISUAL_FILTER_SORT_ORDER}",press:function(b1){y._showChartSortPopup(b1);},layoutData:new sap.m.OverflowToolbarLayoutData({closeOverflowOnInteraction:false,priority:(!sap.ui.Device.system.desktop)?sap.m.OverflowToolbarPriority.AlwaysOverflow:sap.m.OverflowToolbarPriority.High})}).data("idx",i),new O({type:"Transparent",icon:Q,tooltip:"{i18n>VISUAL_FILTER_CHART_TYPE}",text:"{i18n>VISUAL_FILTER_CHART_TYPE}",press:function(b1){y._showChartTypesPopup(b1);},layoutData:new sap.m.OverflowToolbarLayoutData({closeOverflowOnInteraction:false,priority:(!sap.ui.Device.system.desktop)?sap.m.OverflowToolbarPriority.AlwaysOverflow:sap.m.OverflowToolbarPriority.High})}).data("idx",i),new O({id:"template::VisualFilterDialog::MeasureChangeButton::"+I+"::"+M,type:"Transparent",icon:"sap-icon://measure",tooltip:"{i18n>VISUAL_FILTER_MEASURE}",text:"{i18n>VISUAL_FILTER_MEASURE}",press:function(b1){y._showChartMeasuresPopup(b1);},layoutData:new sap.m.OverflowToolbarLayoutData({closeOverflowOnInteraction:false,priority:(!sap.ui.Device.system.desktop)?sap.m.OverflowToolbarPriority.AlwaysOverflow:sap.m.OverflowToolbarPriority.High})}).data("idx",i)];if((sap.ui.Device.system.tablet||sap.ui.Device.system.phone)&&!sap.ui.Device.system.desktop){_.splice(2,0,new C({tooltip:"{i18n>SHOW_ON_FILTER_BAR}",text:"{i18n>SHOW_ON_FILTER_BAR}",selected:y.oConfig.filterCompList[i].shownInFilterBar,layoutData:new sap.m.OverflowToolbarLayoutData({closeOverflowOnInteraction:false,priority:sap.m.OverflowToolbarPriority.AlwaysOverflow})}).data("idx",i).attachSelect(null,y._onCheckBoxSelect,y));_[2].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDShowInFilterBarCozy");}var a1=new sap.m.OverflowToolbar({design:sap.m.ToolbarDesign.Transparent,content:[R,new sap.m.ToolbarSpacer(),_]}).addStyleClass("sapSmartTemplatesAnalyticalListPageFilterDialogTitleToolbar");a1.getContent()[0].addStyleClass("sapUiTinyMarginTop");a1.getContent()[0].addStyleClass("sapSmartTemplatesAnalyticalListPageVFDialogChartTitle");a1.setWidth("100%");return a1;},_addChart:function(i,y,z){var A;var E=this;var I={scaleFactor:y.scaleFactor,numberOfFractionalDigits:y.numberOfFractionalDigits,sortOrder:y.sortOrder,filterRestriction:y.filterRestriction,isDropDown:y.isDropDown,width:u,height:y.height,labelWidthPercent:v,entitySet:y.entitySet,dimensionField:y.dimensionField,dimensionFieldDisplay:y.dimensionFieldDisplay,dimensionFieldIsDateTime:y.dimensionFieldIsDateTime,unitField:y.unitField,isCurrency:y.isCurrency,isMandatory:y.isMandatory,measureField:y.measureField,dimensionFilter:y.dimensionFilter,outParameter:y.outParameter,inParameters:y.inParameters,parentProperty:y.parentProperty,textArrangement:y.textArrangement,chartQualifier:y.chartQualifier};var J="/filterCompList/"+z;if(i==="Donut"){I.labelWidthPercent=w;}i=this.oState.alr_visualFilterBar._resolveChartType(i);var A=this.oState.alr_visualFilterBar._createFilterItemOfType(i,I);A.data("idx",z);A.addCustomData(new sap.ui.core.CustomData({key:'sPath',value:J}));A.bindProperty('visible',{path:'_visualFilterConfigModel>/filterCompList/'+z+'/showChartOverlay',formatter:function(e){return!e;}});A.bindProperty('dimensionFilter',{path:'_filter>/'+A.getParentProperty()});var K=A.getInParameters(),M=[];if(K&&K.length>0){K.forEach(function(e){M.push({path:"_filter>/"+e.localDataProperty});});}if(E.oState.alr_visualFilterBar.getEntitySet()===A.getEntitySet()){var N=E.oState.alr_visualFilterBar._smartFilterContext.determineMandatoryFilterItems();if(N&&N.length>0){N.forEach(function(e){if(!e.data("isCustomField")){M.push({path:'_filter>/'+e.getName()});}});}}if(M&&M.length>0){A.bindProperty('dimensionFilterExternal',{parts:M,formatter:function(){var K=this.getInParameters(),Q=this.getParentProperty();var R,U;if(E.oState.alr_visualFilterBar.getEntitySet()===this.getEntitySet()){var N=E.oState.alr_visualFilterBar._smartFilterContext.determineMandatoryFilterItems();N.forEach(function(i1){var j1=i1.getName();var k1=K&&K.some(function(e){return e.localDataProperty===j1;});if(j1.indexOf("$Parameter")===-1&&!k1){K.push({localDataProperty:j1,valueListProperty:j1});}});}if(!(E.oState.alr_visualFilterBar.getEntitySet()===this.getEntitySet()&&E.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath()!=="")&&(E.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath()===""||E.oState.alr_visualFilterBar._smartFilterContext.getAnalyticBindingPath().indexOf("P_DisplayCurrency")!=-1)){var W=this.getMeasureField();var X=E.oState.alr_visualFilterBar.getModel();var Y=X.getMetaModel();var Z=Y.getODataEntityType(E.oState.alr_visualFilterBar._oMetadataAnalyser.getEntityTypeNameFromEntitySetName(this.getEntitySet()));var $=Y.getODataEntitySet(this.getEntitySet());var _=Y.getODataProperty(Z,W);var a1=E.oState.alr_visualFilterBar.getProperty("displayCurrency");var b1=_&&_[q.ISOCurrency];if(a1&&b1){var c1=b1.Path;for(var d1=(K.length-1);d1>-1;d1--){var e1=K[d1].valueListProperty;var f1=K[d1].localDataProperty;if(e1===c1){var g1=E.oState.alr_visualFilterBar._smartFilterContext.getFilterData();if(!g1[f1]){U=Y.getODataProperty(Z,c1);var h1=U&&F.isPropertyNonFilterable($,U.name);if(!h1){R=new r({aFilters:[new r({path:c1,operator:"EQ",value1:a1,value2:undefined})],and:false});}}break;}}}}return E.oState.alr_visualFilterBar._getFiltersForFilterItem(K,Q,R,c1);}});}A._updateBinding();A._bAllowBindingUpdateOnPropertyChange=true;A.attachFilterChange(function(e){E._filterModified=true;E.oState.alr_visualFilterBar.fireFilterChange();});A.attachTitleChange(function(e){var z=e.getSource().data("idx");if(E.filterCompList[z].toolbar.getContent().length>0){if(I.isMandatory){E.filterCompList[z].toolbar.getContent()[0].addStyleClass("sapMLabelRequired");}E.filterCompList[z].toolbar.getContent()[0].setText(E._getChartTitle(E.filterCompList[z].obj,z));}});return A;},_createMoreFiltersLink:function(e,y){var z=this;var A=0;var i;var E=new f();for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].searchVisible&&this.filterCompList[i].obj.group.name===e&&!this.filterCompList[i].obj.shownInFilterDialog){A++;}}if(A>0){E.setText(this.oRb.getText("FILTER_BAR_SHOW_MORE_FILTERS",[A]));}else{E.setText(this.oRb.getText("FILTER_BAR_SHOW_CHANGE_FILTERS"));}E.attachPress(function(I){z._createAddRemoveFiltersDialog(e,E);});if(y){E.addAriaLabelledBy(y);}return E;},_showChartMeasuresPopup:function(e){var i=this;var y=e.getSource().data("idx");var z=this.filterChartList[y].getProperty("entitySet");var A=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(e.getSource().getModel('i18n'),"VISUAL_FILTER_MEASURES");var E=new g({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true});E.data("idx",y);A.addContent(E);var I=this.oState.alr_visualFilterBar._getMeasureMap()[z];E.addStyleClass("sapUiSizeCompact");if(I){for(var J in I){var K=new k({title:I[J].label?I[J].label:I[J].name,tooltip:(I[J].fieldInfo&&I[J].fieldInfo.quickInfo)||I[J].label||I[J].name}).data("measureName",I[J].name);E.addItem(K);if(this.filterChartList[y].getMeasureField()===I[J].name){E.setSelectedItem(K);}}}E.attachSelectionChange(function(e){var y=e.getSource().data("idx"),M=e.getSource().getSelectedItem().data("measureName");i.filterChartList[y].setProperty("unitField",I[M].fieldInfo.unit);i.filterCompList[y].toolbar.getContent()[0].setText(i._getChartTitle(i.filterCompList[y].obj,y));i.oConfig.filterCompList[y].component.properties.measureField=M;if(!i.filterChartList[y]._chart.getPoints){var N=jQuery.extend(true,[],i.filterChartList[y].getSortOrder());N[0].Field.String=M;i.filterChartList[y].setSortOrder(N);i._updateVisualFilterConfigModel(y,'/component/properties/sortOrder',N);}var Q={bUpdateBinding:true,value:M};i.filterChartList[y].setMeasureField(Q);i._updateVisualFilterConfigModel(y,'/component/properties/measureField',Q);i._updateVisualFilterConfigModel(y,'/component/properties/measureField',M);i._updateVisualFilterConfigModel(y,'/component/properties/unitField',I[M].fieldInfo.unit);i._filterModified=true;if(A){A.close();}});A.attachAfterClose(function(){A.destroy();A=null;});A.openBy(e.getSource());},_showChartTypesPopup:function(e){var y=this;var z=e.getSource();var A=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(e.getSource().getModel('i18n'),"VISUAL_FILTER_CHART_TYPES");var E=this.oState.alr_visualFilterBar._getSupportedFilterItemList();var I=[];var J=false;for(var i=0;i<E.length;i++){var K=E[i];var M=new k({title:"{i18n>"+K.textKey+"}",icon:K.iconLink,selected:z.getIcon()===K.iconLink}).data("type",K.type);I.push(M);}var N=new g({mode:sap.m.ListMode.SingleSelectMaster,items:I});N.data("button",z);N.addStyleClass("sapUiSizeCompact");A.addContent(N);N.attachSelectionChange(function(e){var Q=e.getSource().data("button").data("idx"),R=e.getSource().getSelectedItem().data("type"),U=y.filterChartList[Q],W=U.getDimensionField(),X=U.getMeasureField(),Y=U.getDimensionFieldIsDateTime(),Z=F.readProperty(y.oConfig,"filterCompList."+Q+".component.properties.sortOrder.0.Field.String"),$=y.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),_=jQuery.extend(true,{},$.getProperty('/filterCompList/'+Q)),a1=F.readProperty(_,"component.properties.sortOrder.0.Field.String");y.oConfig.filterCompList[Q].component.type=R;J=true;e.getSource().data("button").setIcon(y._getChartTypeIconLink(R));if(Z&&a1){if(R==="Line"){y.oConfig.filterCompList[Q].component.properties.sortOrder[0].Field.String=W;_.component.properties.sortOrder[0].Field.String=W;if(Y){y.bSortOrder=y.oConfig.filterCompList[Q].component.properties.sortOrder[0].Descending.Boolean;y.oConfig.filterCompList[Q].component.properties.sortOrder[0].Descending.Boolean=true;_.component.properties.sortOrder[0].Descending.Boolean=true;y.bIsTimeBasedLine=true;}}else{y.oConfig.filterCompList[Q].component.properties.sortOrder[0].Field.String=X;_.component.properties.sortOrder[0].Field.String=X;if(y.bIsTimeBasedLine){y.oConfig.filterCompList[Q].component.properties.sortOrder[0].Descending.Boolean=y.bSortOrder;_.component.properties.sortOrder[0].Descending.Boolean=y.bSortOrder;y.bIsTimeBasedLine=false;}}}_.component.type=R;$.setProperty('/filterCompList/'+Q,_);y.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);y.oState.alr_visualFilterBar.updateVisualFilterBindings(true);if(A){A.close();}});A.attachBeforeClose(function(){if(J){y._filterModified=true;y._reloadForm();}});A.attachAfterClose(function(){A.destroy();A=null;});A.openBy(e.getSource());},_showLineChartTimeAxisPopup:function(e){var i=e.getSource().data("idx");var y=e.getSource();var z=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(e.getSource().getModel('i18n'),"VISUAL_FILTER_LINE_CHART_TIME_LINE");var A=new g({mode:sap.m.ListMode.SingleSelectLeft,items:[new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_DAYS}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_MONTH}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_QUARTERS}"}).data("idx",i),new k({title:"{i18n>VISUAL_FILTER_LINE_CHART_TIME_LINE_YEARS}"}).data("idx",i)]});A.data("button",y);A.addStyleClass("sapUiSizeCompact");z.addContent(A);A.attachSelectionChange(function(e){z.close();});z.attachAfterClose(function(){z.destroy();z=null;});z.openBy(e.getSource());},_showChartSortPopup:function(e){var i=this;var y=e.getSource().data("idx");var z=e.getSource();var A=e.getSource().getModel('i18n');var E=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(A,"VISUAL_FILTER_SORTING");var I=new g({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new k({title:A.getResourceBundle().getText("VISUAL_FILTER_SORTING_ASCENDING")}).data("idx",y),new k({title:A.getResourceBundle().getText("VISUAL_FILTER_SORTING_DESCENDING")}).data("idx",y)]});I.data("button",z);I.addStyleClass("sapUiSizeCompact");if(this.filterChartList[y].getSortOrder()[0].Descending.Boolean){I.setSelectedItem(I.getItems()[1],true);}else{I.setSelectedItem(I.getItems()[0],true);}E.addContent(I);I.attachSelectionChange(function(e){var z=e.getSource().data("button");var y=z.data("idx");var J=jQuery.extend(true,[],i.filterChartList[y].getSortOrder());J[0].Descending.Boolean=e.getSource().getItems()[1].isSelected();if(J[0].Descending.Boolean){z.setIcon("sap-icon://sort-descending");}else{z.setIcon("sap-icon://sort-ascending");}var K={bUpdateBinding:true,value:J};i.filterChartList[y].setSortOrder(K);i._updateVisualFilterConfigModel(y,'/component/properties/sortOrder',K);i._updateVisualFilterConfigModel(y,'/component/properties/sortOrder',J);i._filterModified=true;if(E){E.close();}});E.attachAfterClose(function(){E.destroy();E=null;});E.openBy(e.getSource());},_createAddRemoveFiltersDialog:function(e,y){var i;var z=this;var A=new sap.m.Dialog();A.setTitle(this.oRb.getText("SELECT_FILTER_FIELDS"));A.addStyleClass("sapUiPopupWithPadding");A.addStyleClass("sapUiCompAddRemoveFilterDialog");A.addStyleClass("sapUiSizeCompact");A.setVerticalScrolling(true);var E=new b();var I=new S({placeholder:this.oRb.getText("FILTER_BAR_SEARCH")});this._oSearchField=I;I.attachLiveChange(function(N){z._onAddRemoveFiltersSearch(N);});E.addContentRight(I);A.setSubHeader(E);this.addRemoveList=new g({mode:sap.m.ListMode.MultiSelect});this.addRemoveList.setShowSeparators(l.None);A.addContent(this.addRemoveList);for(i=0;i<this.filterCompList.length;i++){if(this.filterCompList[i].obj.group.name===e&&this.filterCompList[i].searchVisible){var J=new k({title:this._getChartTitle(this.filterCompList[i].obj,i,true)}).data("idx",i);this.addRemoveList.addItem(J);if(this.filterCompList[i].obj.shownInFilterDialog){this.addRemoveList.setSelectedItem(J,true);}}}this.addRemoveList.attachSelectionChange(function(N){if(N){var Q=N.getParameters();if(Q){var J=Q.listItem;var R=J.data("idx");if(J){var U={bVisible:Q.selected,propertyName:z.oConfig.filterCompList[R].component.properties.parentProperty};z.oState.alr_visualFilterBar.fireFilterChange(U);}}}});var K=new B({text:this.oRb.getText("FORM_PERS_DIALOG_OK")});K.attachPress(function(){var i;var N=z.addRemoveList.getItems();var Q=z.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel'),R=jQuery.extend(true,{},Q);for(i=0;i<N.length;i++){var U=N[i].data("idx");var W=N[i].isSelected();R.setProperty('/filterCompList/'+U+'/shownInFilterBar',W);R.setProperty('/filterCompList/'+U+'/shownInFilterDialog',W);}Q.setData(R.getData());z.oConfig=JSON.parse(Q.getJSON());z.oState.alr_visualFilterBar.updateVisualFilterBindings(true);z.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);z._filterModified=true;z._reloadForm();A.close();});A.addAggregation("buttons",K);A.setInitialFocus(this._oSearchField);A.setContentHeight("23.25rem");var M=new B({text:this.oRb.getText("FORM_PERS_DIALOG_CANCEL"),press:function(){A.close();}});A.addAggregation("buttons",M);A.attachAfterClose(function(){A.destroy();A=null;});A.open();},_onAddRemoveFiltersSearch:function(e){var i;if(!e){return;}var y=e.getParameters();if(!y){return;}var z=(y.newValue?y.newValue:"").toLowerCase();var A=this.addRemoveList.getItems();for(i=0;i<A.length;i++){var E=(A[i].getTitle()).toLowerCase();A[i].setVisible(E.indexOf(z)>=0);}},_getChartTypeIconLink:function(i){var e=this.oState.alr_visualFilterBar._getSupportedFilterItemMap();var y=e[i];return!y?"":y.iconLink;},_getChartTitle:function(e,i,y){var z="";if(this.filterChartList[i]){if(y){e.component.properties=this.filterChartList[i].getP13NConfig();z=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(e);}else{z=this.filterChartList[i].getTitle();}}else{e.component.properties=this.oConfig.filterCompList[i].component.properties;z=this.oState.alr_visualFilterBar.getTitleByFilterItemConfig(e);}return z;},_adjustToolbarIcons:function(i){if(this.filterCompList[i].obj.component.type==="Line"){this.filterCompList[i].toolbar.getContent()[1].getItems()[1].setVisible(true);this.filterCompList[i].toolbar.getContent()[1].getItems()[2].setVisible(false);}else{this.filterCompList[i].toolbar.getContent()[1].getItems()[1].setVisible(false);this.filterCompList[i].toolbar.getContent()[1].getItems()[2].setVisible(true);}},_updateVisualFilterConfigModel:function(i,e,y,I){var z=this.oState.alr_visualFilterBar.getModel('_visualFilterConfigModel');z.setProperty('/filterCompList/'+i+e,y);if(I){var M=jQuery.extend(true,{},z.getProperty('/filterCompList/'+i));z.setProperty('/filterCompList/'+i,M);this.oState.alr_visualFilterBar.updateVisualFilterBindings(true);}this.oConfig=JSON.parse(z.getJSON());this.oState.oSmartFilterbar._oVariantManagement.currentVariantSetModified(true);},_triggerSearchInFilterDialog:function(e){var i;if(!e){return;}var y=e.getParameters();if(!y){return;}var z=(y.newValue?y.newValue:"").toLowerCase();for(i=0;i<this.oConfig.filterCompList.length;i++){var A=this.oConfig.filterCompList[i].component.properties;this.oConfig.filterCompList[i].searchVisible=(A.parentProperty.toLowerCase().indexOf(z)>=0)||(A.measureField.toLowerCase().indexOf(z)>=0);}this._reloadForm();}});sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog=function(i,e){if(this._oPopoverDialog){this._oPopoverDialog.destroy();}this._oPopoverDialog=new sap.m.Popover();this._oPopoverDialog.setTitle(i.getResourceBundle().getText(e));this._oPopoverDialog.setPlacement(sap.m.PlacementType.PreferredBottomOrFlip);this._oPopoverDialog.addStyleClass("sapUiPopupWithPadding");return this._oPopoverDialog;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList=function(e,y){var z=new g({mode:sap.m.ListMode.Delete}),A,E=e.getFilterRestriction();z.data("chart",e);if(E==='multiple'){A=jQuery.extend(true,{},e.getDimensionFilter());var I=(A&&A.items)?A.items:undefined,J=(A&&A.ranges)?A.ranges:undefined,K=(A&&A.value)?A.value:null;A=jQuery.extend(true,{},e.getDimensionFilter());if(I){for(var i=0;i<I.length;i++){var M=new k({title:I[i].text?I[i].text:I[i].key});if(M){M.addCustomData(new sap.ui.core.CustomData({key:'items',value:i}));}z.addItem(M);}}if(J){for(var i=0;i<J.length;i++){var M=new k({title:J[i].tokenText?J[i].tokenText:F.createTitleFromCode(J[i])});M.addCustomData(new sap.ui.core.CustomData({key:'ranges',value:i}));z.addItem(M);}}if(K){var M=new k({title:K});M.addCustomData(new sap.ui.core.CustomData({key:'value'}));z.addItem(M);}}else{z.addItem(new k({title:e.getDimensionFilter()}));}z.attachDelete(function(N){var Q=N.getParameter("listItem"),R=z.data('chart'),U;if(E==='single'){U=null;}else{U=jQuery.extend(true,{},R.getDimensionFilter());var W=Q.getCustomData()[0],X=W.getKey(),Y=U[X];if(X!=='value'){var Z=W.getValue();Y.splice(Z,1);}else{U.value=null;}}z.removeItem(Q);R.setDimensionFilter(U);R.fireFilterChange();y.removeContent(z);var $=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(R,y);if($.getItems().length>0){y.addContent($);y.focus();}else{y.close();}});return z;};sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController.launchAllFiltersPopup=function(e,i,y){var z=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createPopoverDialog(y,"VISUAL_FILTER_ALL_SELECTED_FILTERS"),A=sap.suite.ui.generic.template.AnalyticalListPage.controller.VisualFilterDialogController._createFilterItemSelectedList(i,z);z.addContent(A);z.addStyleClass("sapUiSizeCompact");z.addStyleClass("sapSmartTemplatesAnalyticalListPageSelectedLinkDialog");var E=new sap.m.Bar();var I=new B({text:y.getResourceBundle().getText("CLEAR_FILTERS_ALL"),press:function(J){var K=A.data('chart'),M=K.getFilterRestriction(),N;if(M==='multiple'){N=jQuery.extend(true,{},K.getDimensionFilter());N.items=[];N.ranges=[];N.value=null;}else{N=null;}z.removeContent(A);K.setDimensionFilter(N);K.fireFilterChange();z.close();}});E.addContentRight(I);z.setFooter(E);z.attachAfterClose(function(){z.destroy();z=null;});z.openBy(e);};return x;});
